# Quantile absolute deviation
qad <- function(x, p, constant = 1) {
  x <- x[!is.na(x)]
  as.numeric(quantile(abs(x - median(x)), p)) * constant
}

# Standard quantile absolute deviation
sqad <- function(x, constant = NULL) {
  x <- x[!is.na(x)]
  n <- length(x)
  if (n == 0) return(NA)
  constants <-
    c(    NA, 1.7724, 1.3506, 1.3762, 1.1881, 1.1773, 1.1289, 1.1248, 1.0920, 1.0943,
      1.0764, 1.0738, 1.0630, 1.0637, 1.0533, 1.0537, 1.0482, 1.0468, 1.0419, 1.0429,
      1.0377, 1.0376, 1.0351, 1.0343, 1.0314, 1.0320, 1.0292, 1.0290, 1.0272, 1.0271,
      1.0251, 1.0253, 1.0238, 1.0235, 1.0223, 1.0224, 1.0210, 1.0210, 1.0201, 1.0199,
      1.0189, 1.0192, 1.0180, 1.0180, 1.0174, 1.0172, 1.0165, 1.0166, 1.0158, 1.0158,
      1.0152, 1.0152, 1.0146, 1.0146, 1.0141, 1.0140, 1.0135, 1.0137, 1.0130, 1.0131,
      1.0127, 1.0126, 1.0123, 1.0124, 1.0118, 1.0119, 1.0115, 1.0115, 1.0111, 1.0112,
      1.0108, 1.0108, 1.0106, 1.0106, 1.0102, 1.0103, 1.0100, 1.0100, 1.0097, 1.0097,
      1.0095, 1.0095, 1.0093, 1.0092, 1.0090, 1.0091, 1.0089, 1.0088, 1.0086, 1.0086,
      1.0084, 1.0084, 1.0082, 1.0082, 1.0081, 1.0081, 1.0079, 1.0079, 1.0078, 1.0077)
  if (is.null(constant)) 
    constant <- if (n <= 100) constants[n] else 1 + 0.762 / n + 0.967 / n^2
  qad(x, pnorm(1) - pnorm(-1), constant)
}

# Optimal quantile absolute deviation
oqad <- function(x, constant = NULL) {
  x <- x[!is.na(x)]
  n <- length(x)
  if (n == 0) return(NA)
  constants <-
    c(    NA, 1.7729, 0.9788, 0.9205, 0.8194, 0.8110, 0.7792, 0.7828, 0.7600, 0.7535,
      0.7388, 0.7365, 0.7282, 0.7284, 0.7241, 0.7234, 0.7170, 0.7155, 0.7113, 0.7110,
      0.7083, 0.7088, 0.7068, 0.7056, 0.7030, 0.7024, 0.7006, 0.7006, 0.6995, 0.6998,
      0.6979, 0.6974, 0.6960, 0.6958, 0.6949, 0.6949, 0.6944, 0.6940, 0.6929, 0.6927,
      0.6918, 0.6918, 0.6913, 0.6914, 0.6907, 0.6904, 0.6897, 0.6896, 0.6891, 0.6892,
      0.6888, 0.6887, 0.6882, 0.6880, 0.6875, 0.6875, 0.6871, 0.6872, 0.6870, 0.6868,
      0.6863, 0.6862, 0.6859, 0.6859, 0.6857, 0.6858, 0.6854, 0.6853, 0.6850, 0.6849,
      0.6847, 0.6847, 0.6846, 0.6845, 0.6842, 0.6841, 0.6839, 0.6839, 0.6837, 0.6838,
      0.6836, 0.6834, 0.6833, 0.6832, 0.6831, 0.6830, 0.6829, 0.6830, 0.6827, 0.6827,
      0.6825, 0.6825, 0.6823, 0.6823, 0.6823, 0.6822, 0.6820, 0.6820, 0.6819, 0.6819)
  if (is.null(constant)) 
    constant <- if (n <= 100) constants[n] else 0.6747309 * (1 + 1.047 / n + 1.193 / n^2)
  qad(x, 0.861678977787423, constant)
}